(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{379:function(t,s,a){"use strict";a.r(s);var e=a(45),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指南"}},[t._v("#")]),t._v(" 指南")]),t._v(" "),a("h2",{attrs:{id:"目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[t._v("#")]),t._v(" 目录")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#目录"}},[t._v("目录")])]),a("li",[a("a",{attrs:{href:"#native-模块"}},[t._v("Native 模块")]),a("ul",[a("li",[a("a",{attrs:{href:"#注释"}},[t._v("注释")])])])]),a("li",[a("a",{attrs:{href:"#处理静态资源"}},[t._v("处理静态资源")]),a("ul",[a("li",[a("a",{attrs:{href:"#例子"}},[t._v("例子:")])])])]),a("li",[a("a",{attrs:{href:"#预加载文件"}},[t._v("预加载文件")])]),a("li",[a("a",{attrs:{href:"#文件夹结构"}},[t._v("文件夹结构")])]),a("li",[a("a",{attrs:{href:"#环境变量"}},[t._v("环境变量")])]),a("li",[a("a",{attrs:{href:"#web-workers"}},[t._v("Web Workers")])]),a("li",[a("a",{attrs:{href:"#using-yarn-workspaces"}},[t._v("Using Yarn Workspaces")])]),a("li",[a("a",{attrs:{href:"#它是如何工作的-须知"}},[t._v("它是如何工作的 [须知]")]),a("ul",[a("li",[a("a",{attrs:{href:"#构建命令"}},[t._v("构建命令")])]),a("li",[a("a",{attrs:{href:"#服务命令"}},[t._v("服务命令")])])])]),a("li",[a("a",{attrs:{href:"#这个插件可在生产环境中使用吗"}},[t._v("这个插件可在生产环境中使用吗？")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"native-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#native-模块"}},[t._v("#")]),t._v(" Native 模块")]),t._v(" "),a("p",[t._v("支持 native 模块，并且在"),a("RouterLink",{attrs:{to:"/zh/guide/security.html#node-integration"}},[t._v("启用 nodeIntegration")]),t._v("的情况下不需要任何配置即可工作。如果出现错误，你可能需要将 native 依赖项设置为 "),a("a",{attrs:{href:"https://webpack.js.org/configuration/externals/",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack external"),a("OutboundLink")],1),t._v("。它应该会被自动找到，但可能不会。为此，请使用 "),a("code",[t._v("externals")]),t._v(" 选项：")],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue.config.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pluginOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    electronBuilder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果 native 依赖项不起作用，请在此处列出")]),t._v("\n      externals"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-native-dep'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果您使用的是 Yarn 工作区，则可能有多个 node_modules 文件夹")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为了让 VCP Electron Builder 能找到它们，请在此处全部列出")]),t._v("\n      nodeModulesPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"注释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[t._v("#")]),t._v(" 注释")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("您可以为 "),a("code",[t._v("externals")]),t._v(" 数组中的项目添加前缀 "),a("code",[t._v("!")]),t._v(" 以防止它被自动标记为外部。( "),a("code",[t._v("!not-external")]),t._v(")")])]),t._v(" "),a("li",[a("p",[t._v("如果你没有在你的代码中使用 native 依赖，你可以删除 "),a("code",[t._v("package.json")]),t._v(" 中 scripts 的 "),a("code",[t._v("postinstall")]),t._v(" 和 "),a("code",[t._v("postuninstall")]),t._v("。 native 模块可能不起作用，但依赖项安装会更快。")])]),t._v(" "),a("li",[a("p",[t._v("使用 MySQL 或 MongoDB 等数据库需要额外的配置。 更多信息见 "),a("a",{attrs:{href:"https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/76#issuecomment-420060179",target:"_blank",rel:"noopener noreferrer"}},[t._v("问题 #76 (comment)"),a("OutboundLink")],1),t._v("。")])])]),t._v(" "),a("h2",{attrs:{id:"处理静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理静态资源"}},[t._v("#")]),t._v(" 处理静态资源")]),t._v(" "),a("p",[t._v("静态资源的工作方式和普通的 web app 一样。阅读 "),a("a",{attrs:{href:"https://cli.vuejs.org/guide/html-and-static-assets.html#static-assets-handling",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue CLI 的文档"),a("OutboundLink")],1),t._v(" 了解更多信息。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("__static")]),t._v(" "),a("p",[t._v("仅在 Electron 中可用，全局变量 "),a("code",[t._v("__static")]),t._v(" 被添加到主进程和渲染进程中。\n它被设置为磁盘上公用文件夹的路径。如果您需要对文件使用 Node APIs ，比如 "),a("code",[t._v("fs.readFileSync")]),t._v(" 或 "),a("code",[t._v("child_process.spawn")]),t._v("，那么这是非常有用的。\n请注意，公用文件夹中的文件在生产中是只读的，因为它们被打包到 "),a("code",[t._v(".asar")]),t._v(" 存档(archive) 中。如果需要文件可写，可以使用 "),a("a",{attrs:{href:"https://www.electron.build/configuration/contents#extraresources",target:"_blank",rel:"noopener noreferrer"}},[t._v("electron-builder's extraResources 配置"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Videos 视频")]),t._v(" "),a("p",[t._v("默认情况下，视频将无法从公共文件夹加载。 如果您正在使用 Electron 11 + ，只需添加 "),a("code",[t._v("stream: true")]),t._v(" 到主进程文件(默认是 "),a("code",[t._v("background.(js|ts)")]),t._v(") 的第 10 行的 privileges 键配置中，具体修改为: "),a("code",[t._v("{ scheme: 'app', privileges: { secure: true, standard: true, stream: true } }")]),t._v("。 如果您不想使用 Electron 11+，则必须配置和使用 "),a("code",[t._v("local-resource")]),t._v(" 协议， 请参阅"),a("RouterLink",{attrs:{to:"/zh/guide/security.html#loading-local-images-resources"}},[t._v("这些文档")]),t._v("了解相关说明，更多信息见"),a("a",{attrs:{href:"https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/872",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个 GitHub 问题"),a("OutboundLink")],1),t._v(".")],1)]),t._v(" "),a("h3",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子:")]),t._v(" "),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 加载图片，将由 webpack 处理 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./assets/logo.png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- webpack 不会处理从 `public` 文件夹中加载的图片，仅复制 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- imgPath 应该等于 `path.join(process.env.BASE_URL, 'logo.png')` --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(":src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("imgPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 希望 myText.txt 被放置在公用文件夹中，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只在 electron serve/build 中生效，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不会在渲染进程中生效，除非你启用 nodeIntegration 。")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileLocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__static"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myText.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileContents "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileLocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileContents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h2",{attrs:{id:"预加载文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预加载文件"}},[t._v("#")]),t._v(" 预加载文件")]),t._v(" "),a("p",[t._v("预加载文件允许您在 Vue App 的上下文中执行带有 "),a("RouterLink",{attrs:{to:"/guide/configuration.html#node-integration"}},[t._v("Node integration")]),t._v(" 的 JS (共享 "),a("code",[t._v("window")]),t._v(" 变量)。创建一个预加载文件并按如下方式更新 "),a("code",[t._v("vue.config.js")]),t._v(" :")],1),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pluginOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    electronBuilder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      preload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/preload.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或者，多个预加载文件:")]),t._v("\n      preload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" preload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/preload.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" otherPreload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/preload2.js'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后，更新主进程文件 (默认是"),a("code",[t._v("src/background.(js|ts)")]),t._v(") 中的 "),a("code",[t._v("new BrowserWindow")]),t._v(" 调用，增加 preload 选项:")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("const win = new BrowserWindow({\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v(" width: 800,\n")]),a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v(" height: 600,\n")]),a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v(" webPreferences: {\n")]),a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v("   // Use pluginOptions.nodeIntegration, leave this alone\n")]),a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v("   // See nklayman.github.io/vue-cli-plugin-electron-builder/guide/configuration.html#node-integration for more info\n")]),a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v("   nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,\n")])]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[a("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v("   preload: path.join(__dirname, 'preload.js')\n")])]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[a("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token line"}},[t._v(" }\n")])]),t._v("})\n")])])]),a("p",[t._v("你需要重新运行 "),a("code",[t._v("electron:serve")]),t._v(" 以使更改生效。")]),t._v(" "),a("h2",{attrs:{id:"文件夹结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件夹结构"}},[t._v("#")]),t._v(" 文件夹结构")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("├── dist_electron/\n│ ├── bundled/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# webpack 输出的已编译文件")]),t._v("\n│ ├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("target platform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("-unpacked/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 未打包的Electron应用 (main app and supporting files)")]),t._v("\n│ ├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("application name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" setup "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("target binary "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exe"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("dmg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("rpm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Electron应用的安装程序")]),t._v("\n│ ├── index.js  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译好的 background 文件，用于 electron:serve")]),t._v("\n│ └── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n├── public/  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以使用 __static or process.env.BASE_URL 访问的文件")]),t._v("\n├── src/\n│ ├── background."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("js"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# electron 的入口文件 (作为 Electron 的主进程)")]),t._v("\n│ ├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("js"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app 的入口文件 (作为 Electron 的渲染进程)")]),t._v("\n│ └── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n├── package.json  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app 的 package.json 文件")]),t._v("\n├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("h2",{attrs:{id:"环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境变量"}},[t._v("#")]),t._v(" 环境变量")]),t._v(" "),a("p",[t._v("阅读 "),a("a",{attrs:{href:"https://cli.vuejs.org/guide/mode-and-env.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue ClI 文档"),a("OutboundLink")],1),t._v(" 了解如何在 app 中使用环境变量。 所有以 "),a("code",[t._v("VUE_APP_")]),t._v(" 作为前缀的环境变量，都将在主进程和渲染器进程中可用。")]),t._v(" "),a("h2",{attrs:{id:"web-workers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-workers"}},[t._v("#")]),t._v(" Web Workers")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/GoogleChromeLabs/worker-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("Worker-plugin"),a("OutboundLink")],1),t._v(" 在 Electron 和 web 中可以开箱即用。安装它，然后将以下内容添加到您的 "),a("code",[t._v("vue.config.js")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" WorkerPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'worker-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  configureWebpack"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WorkerPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("现在，像这样创建一个 worker:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./worker.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'module'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"using-yarn-workspaces"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-yarn-workspaces"}},[t._v("#")]),t._v(" Using Yarn Workspaces")]),t._v(" "),a("p",[t._v("If you are using "),a("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/workspaces/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Yarn workspaces"),a("OutboundLink")],1),t._v(" you need to set "),a("code",[t._v("nodeModulesPath")]),t._v(" to include both the package node_modules, and the workspace node_modules.")]),t._v(" "),a("p",[t._v("You should also move your eslint config to the workspace root or you'll get lots of weird messages.")]),t._v(" "),a("p",[t._v("This is becuase yarn workspaces 'hoists' shared dependencies to the top level and this plugin needs to be able to scan your node_modules to check for native dependencies to externalize.")]),t._v(" "),a("p",[t._v("For example, with this directory structure:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("package.json (in workspace root)\npackages/\n  app/\n  components/\n")])])]),a("p",[t._v("Inside "),a("code",[t._v("packages/app/vue.config.js")]),t._v(" add the following line to the plugin config:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("module.exports = {\n  pluginOptions: {\n    electronBuilder: {\n      nodeModulesPath: ['./node_modules', '../../node_modules'],\n      ...\n    }\n  }\n}\n")])])]),a("h2",{attrs:{id:"它是如何工作的-须知"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#它是如何工作的-须知"}},[t._v("#")]),t._v(" 它是如何工作的 [须知]")]),t._v(" "),a("h3",{attrs:{id:"构建命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建命令"}},[t._v("#")]),t._v(" 构建命令")]),t._v(" "),a("p",[t._v("build 构建命令包含 3 个主要阶段：渲染构建、 main 主构建和 electron-builder 构建：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("渲染构建")]),t._v(": 这个阶段调用 "),a("code",[t._v("vue-cli-service build")]),t._v(" 构建，使用一些自定义配置， 这样它就可以正常地与 electron 一起工作。 (渲染过程是你的 standard app.)")]),t._v(" "),a("li",[a("strong",[t._v("主构建")]),t._v(": 这个阶段是 VCP-Electron-Builder 为主进程 ("),a("code",[t._v("src/background.js")]),t._v(") 打包 background 文件。")]),t._v(" "),a("li",[a("strong",[t._v("Electron-builder 构建")]),t._v(": 此阶段使用 "),a("a",{attrs:{href:"https://www.electron.build",target:"_blank",rel:"noopener noreferrer"}},[t._v("electron-builder"),a("OutboundLink")],1),t._v(" 将您的 Web 应用程序代码转换为由 "),a("a",{attrs:{href:"https://electronjs.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Electron"),a("OutboundLink")],1),t._v(" 提供支持的桌面应用程序。")])]),t._v(" "),a("p",[t._v("译者：")]),t._v(" "),a("ul",[a("li",[a("em",[t._v("[1] 如果 vue app 内容没有变化，不会重新打包。直接进入下步。")])]),t._v(" "),a("li",[t._v("[ ] background.js 可以访问 VUE_APP_xxx 环境变量吗？")])]),t._v(" "),a("h3",{attrs:{id:"服务命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务命令"}},[t._v("#")]),t._v(" 服务命令")]),t._v(" "),a("p",[t._v("serve 服务命令也包括 3 个主要阶段： 主要构建、开发服务器启动和 electron 启动:")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("开发服务器启动")]),t._v("：此阶段启动内置开发服务器，并进行一些修改，这样它就可以正常地与 electron 一起工作。")]),t._v(" "),a("li",[a("strong",[t._v("主构建")]),t._v("：这个阶段，就像在构建命令中一样，打包应用程序的主进程，但处于开发模式。")]),t._v(" "),a("li",[a("strong",[t._v("Electron launch启动")]),t._v("：此阶段启动电子并告诉它加载上述开发服务器的 url 。")])]),t._v(" "),a("h2",{attrs:{id:"这个插件可在生产环境中使用吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#这个插件可在生产环境中使用吗"}},[t._v("#")]),t._v(" 这个插件可在生产环境中使用吗？")]),t._v(" "),a("p",[t._v("该插件已准备好在生产环境中使用。它具有完整的 e2e 和单元测试覆盖率，并已在许多大大小小的应用程序中使用。 但是，任何代码都不能避免错误，如果您确实发现了错误，请报告以进行修复。")])])}),[],!1,null,null,null);s.default=n.exports}}]);